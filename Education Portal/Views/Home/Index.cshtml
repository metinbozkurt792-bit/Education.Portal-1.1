@model List<Education_Portal.Models.Course>

@{
    ViewData["Title"] = "Ana Sayfa";
    Layout = "~/Views/Shared/_LayoutCourse.cshtml";

    var categories = ViewBag.Categories as List<Education_Portal.Models.Category>;
}

<div class="container mt-5">

    <div class="text-center mb-4">
        <h1 class="display-5 fw-bold mb-3">Hayalindeki Kursu Bul</h1>
        <p class="lead text-muted">Kategorini seç veya arama yap, öğrenmeye hemen başla.</p>
    </div>

    <div class="row justify-content-center mb-5">
        <div class="col-md-8 col-lg-6">
            <div class="input-group input-group-lg shadow-sm">
                <input type="text" id="txtSearch" class="form-control border-secondary" placeholder="Kurs adı veya konu ara..." aria-label="Arama">
                <button class="btn btn-dark px-4" type="button" id="btnSearch">
                    <i class="fas fa-search me-2"></i>Ara
                </button>
            </div>
        </div>
    </div>

    <div class="d-flex justify-content-center flex-wrap gap-2 mb-5">
        <button class="btn btn-dark category-btn active" data-id="0">Tümü</button>

        @if (categories != null)
        {
            foreach (var cat in categories)
            {
                <button class="btn btn-outline-secondary category-btn" data-id="@cat.Id">
                    @cat.Name
                </button>
            }
        }
    </div>

    <div id="courseContainer" style="min-height: 300px;">
        <partial name="_CourseList" model="Model" />
    </div>

    <div id="loader" class="text-center py-5" style="display:none;">
        <div class="spinner-border text-primary" role="status">
            <span class="visually-hidden">Yükleniyor...</span>
        </div>
    </div>

</div>

@section Scripts {
    <script>
        $(document).ready(function () {

            var currentCategoryId = 0;


            $(".category-btn").click(function () {
                $(".category-btn").removeClass("btn-dark active").addClass("btn-outline-secondary");
                $(this).removeClass("btn-outline-secondary").addClass("btn-dark active");

                currentCategoryId = $(this).data("id"); 
                LoadCourses(); 
            });

            $("#btnSearch").click(function () {
                LoadCourses();
            });

            $("#txtSearch").keypress(function (e) {
                if (e.which == 13) { 
                    LoadCourses();
                }
            });

            function LoadCourses() {

                var searchText = $("#txtSearch").val();

                $("#courseContainer").css("opacity", "0.3");
                $("#loader").show();

                $.ajax({
                    url: '/Home/GetCourses',
                    type: 'GET',
                    data: { categoryId: currentCategoryId, search: searchText },
                    success: function (res) {
                        $("#courseContainer").html(res);
                        $("#courseContainer").animate({ opacity: 1 }, 200);
                        $("#loader").hide();
                    },
                    error: function () {
                        alert("Bir hata oluştu! Lütfen sayfayı yenileyin.");
                        $("#loader").hide();
                        $("#courseContainer").css("opacity", "1");
                    }
                });
            }
        });
    </script>
}